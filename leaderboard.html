<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <title>Fantasy Goons Leaderboard</title>

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <!-- ðŸ§­ Navbar -->
    <nav class="navbar">
    <div class="container nav-inner">
      <a href="index.html" class="logo">🏈 Fantasy Goons</a>
      <button class="menu-toggle" type="button" aria-label="Toggle menu" aria-expanded="false"><span aria-hidden="true">&#9776;</span></button>
      <ul class="nav-links">
        <li><a href="leaderboard.html" class="active" data-title="Live Rankings">Leaderboard</a></li>
        <li><a href="commentary.html" data-title="Weekly Insights">Commentary</a></li>
        <li><a href="teams.html" data-title="Locker Room">Locker Room</a></li>
      </ul>
    </div>
  </nav>

  <!-- ðŸ† Main Content -->
  <main class="container leaderboard-page">
    <h1>Weekly Rankings & Matchups<h1>

    <!-- Stat Cards -->
  <div class="stats-cards">
  <div class="card card--top">
    <h3>Most Points</h3>
    <p id="top-team">muhfuckin uhhhh...</p>
    <p id="top-score" class="top-score">--</p>
  </div>

  <div class="card card--low">
    <h3>Least Points</h3>
    <p id="low-team">--</p>
    <p id="low-score" class="low-score">--</p>
  </div>

  <div class="card card--blowout">
    <h3>Largest Blow Out</h3>
    <p id="blowout-match">--</p>
  </div>

  <div class="card card--closest">
    <h3>Closest Matchup</h3>
    <p id="closest-match">--</p>
  </div>
</div>

    <!-- Week Tabs -->
    <div class="week-tabs" id="week-tabs"></div>
    <h2 id="week-title">Ur gay...</h2>
    <p> Select the prior week for stats recap. Click 'Show Matchups' at bottom to see PVP board.</p>

<!-- Standings -->
<section class="grid-section">
  <h3>Standings</h3>
  <div id="standings-grid" class="grid-cards"></div>
</section>

<!-- Matchups -->
<section class="matchups-section fade-up" style="margin-top:30px;">
  <button id="toggle-matchups" class="btn btn-secondary mobile-toggle">Show Matchups</button>
  <div id="matchups-container" class="grid-section">
    <h3>This Weeks Matchups</h3>
    <div id="matchups-grid" class="grid-cards"></div>
  </div>
</section>

    <!-- Share Buttons -->
    <div class="share-controls fade-up">
      <button id="share-email" class="btn btn-primary">Share via Email</button>
      <button id="share-sms" class="btn btn-secondary">Share via Text</button>
    </div>

    <!-- Send Weekly Update -->
    <div class="send-update fade-up" style="text-align:center;margin-top:10px;">
      <button id="send-update-btn" class="btn btn-primary">Send Weekly Update</button>
    </div>
  </main>

  <!-- â¬†ï¸ Back to Top -->
  <button id="back-to-top" aria-label="Back to top">â¬†</button>

  <!-- =========================
       ðŸ“Š Leaderboard Logic
  ========================== -->
  <script>
  (function(){
    const sheetUrl =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTs0y3FdEeiA63VHrIISxQLQq0j2uBX6MHsDYwD_RWmV6540Vfr2nDhv-bobm8iLs5lROwaVvJZabDL/pub?output=csv";

    const weekTabs = document.getElementById("week-tabs");
    const weekTitle = document.getElementById("week-title");

    let data = [], weeks = [];

    document.addEventListener("DOMContentLoaded", init);

    async function init() {
      const csv = await fetch(sheetUrl).then(r=>r.text());
      const rows = csv.split(/\r?\n/).map(r=>r.split(","));
      const header = rows[0].map(h=>h.trim());
      const idx = {
        week: header.indexOf("Week"),
        type: header.indexOf("Type"),
        rank: header.indexOf("Rank"),
        team: header.indexOf("Team"),
        record: header.indexOf("Record"),
        pf: header.indexOf("PF"),
        pa: header.indexOf("PA"),
        streak: header.indexOf("Streak"),
        opp: header.indexOf("Opponent"),
        oppPF: header.indexOf("Opp PF"),
        note: header.indexOf("Note")
      };

      data = rows.slice(1)
        .filter(r => r.filter(Boolean).length > 0)
        .map(r => ({
          week: Number(r[idx.week]),
          type: r[idx.type],
          rank: Number(r[idx.rank]),
          team: r[idx.team],
          record: r[idx.record],
          pf: parseFloat(r[idx.pf]),
          pa: parseFloat(r[idx.pa]),
          streak: r[idx.streak],
          opp: r[idx.opp],
          oppPF: parseFloat(r[idx.oppPF]),
          owner: r[idx.owner],
          note: r[idx.note]
        }));

      weeks = [...new Set(data.map(d=>d.week))].filter(Boolean).sort((a,b)=>a-b);
      buildTabs();
      loadWeek(weeks[weeks.length-1]);
    }

    function buildTabs(){
      weekTabs.innerHTML = weeks.map((w,i)=>
        `<button class="tab ${i===weeks.length-1?'active':''}" data-week="${w}">Week ${w}</button>`
      ).join("");
      weekTabs.querySelectorAll(".tab").forEach(btn=>{
        btn.addEventListener("click",()=>{
          weekTabs.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
          btn.classList.add("active");
          loadWeek(Number(btn.dataset.week));
        });
      });
    }
function loadWeek(week) {
  const standings = data.filter(d => d.week === week && d.type === "Standings");
  const matchups = data.filter(d => d.week === week && d.type === "Matchup");
  weekTitle.textContent = `Week ${week} Overview`;

  const standingsGrid = document.getElementById("standings-grid");
  const matchupsGrid = document.getElementById("matchups-grid");
  standingsGrid.innerHTML = "";
  matchupsGrid.innerHTML = "";

  // ðŸ† Standings Cards
  standings.sort((a, b) => a.rank - b.rank).forEach(d => {
    standingsGrid.innerHTML += `
      <div class="card standing-card">
        <div class="rank">${d.rank}</div>
        <div class="team">${d.team}</div>
        <div class="record">${d.record}</div>
        <div class="pf">PF: ${isFinite(d.pf) ? d.pf : "--"}</div>
        <div class="pa">PA: ${isFinite(d.pa) ? d.pa : "--"}</div>
        <div class="streak">${d.streak || ""}</div>
      </div>`;
  });

  // âš”ï¸ Matchups Cards
  matchups.forEach(d => {
    const diff = (isFinite(d.pf) && isFinite(d.oppPF)) ? (d.pf - d.oppPF).toFixed(1) : "";
    const result = diff > 0 ? "win" : diff < 0 ? "loss" : "tie";
    matchupsGrid.innerHTML += `
      <div class="card matchup-card ${result}">
        <h4>${d.team}</h4>
        <p><strong>${d.pf}</strong> vs <strong>${d.opp}</strong> (${d.oppPF})</p>
        <p class="note">${d.note || ""}</p>
        <span class="result-label">${result.toUpperCase()}</span>
      </div>`;
  });

  // ðŸ§® Stat Cards
if (matchups.length) {
  // Build all scores from matchups (team + opponent)
const allScores = matchups.flatMap(m => [
  { team: m.team, pf: m.pf },
  { team: m.opp,  pf: m.oppPF }
]).filter(s => Number.isFinite(s.pf));

// Top scorer
const top = allScores.reduce((a, b) => (b.pf > a.pf ? b : a));
document.getElementById("top-team").textContent = top.team;
document.getElementById("top-score").textContent = `${top.pf.toFixed(1)} pts`;

// Low scorer
const low = allScores.reduce((a, b) => (b.pf < a.pf ? b : a));
document.getElementById("low-team").textContent  = low.team;
document.getElementById("low-score").textContent = `${low.pf.toFixed(1)} pts`;

// Largest blowout
let blowout = null;
let maxMargin = -Infinity;

matchups.forEach(m => {
  if (Number.isFinite(m.pf) && Number.isFinite(m.oppPF)) {
    const margin = Math.abs(m.pf - m.oppPF);
    if (margin > maxMargin) {
      maxMargin = margin;
      blowout = m;
    }
  }
});

if (blowout && Number.isFinite(maxMargin)) {
  const winnerIsHome = blowout.pf >= blowout.oppPF;
  const winner = winnerIsHome ? blowout.team : blowout.opp;
  const loser = winnerIsHome ? blowout.opp : blowout.team;
  document.getElementById("blowout-match").textContent =
    `${winner} over ${loser} (${maxMargin.toFixed(1)} pts)`;
} else {
  document.getElementById("blowout-match").textContent = "No eligible matchups.";
}

  // âš”ï¸ Closest Matchup
  let closest = null;
  let diff = Infinity;

  matchups.forEach(m => {
    if (isFinite(m.pf) && isFinite(m.oppPF)) {
      const margin = Math.abs(m.pf - m.oppPF);
      if (margin < diff) {
        diff = margin;
        closest = m;
      }
    }
  });

    if (closest) {
      document.getElementById("closest-match").textContent =
        `${closest.team} vs ${closest.opp} (${diff.toFixed(1)} pts)`;
    } else {
      document.getElementById("closest-match").textContent = "No valid matchups found.";
    }
  }
}
  })();
  </script>

  <!-- ðŸ“± Collapsible Matchups + State Save -->
  <script>
  const toggleBtn = document.getElementById("toggle-matchups");
  const matchupsContainer = document.getElementById("matchups-container");

  function loadSavedState() {
    if (window.innerWidth <= 670) {
      const saved = localStorage.getItem("matchupsCollapsedMobile");
      if (saved === "true") {
        matchupsContainer.classList.add("collapsed");
        toggleBtn.textContent = "Show Matchups";
      } else {
        matchupsContainer.classList.remove("collapsed");
        toggleBtn.textContent = "Hide Matchups";
      }
    } else {
      matchupsContainer.classList.remove("collapsed");
      toggleBtn.style.display = "none";
    }
  }

  function updateToggleState() {
    if (window.innerWidth <= 670) {
      toggleBtn.style.display = "block";
      loadSavedState();
    } else {
      matchupsContainer.classList.remove("collapsed");
      toggleBtn.style.display = "none";
    }
  }

  toggleBtn.addEventListener("click", () => {
    const isCollapsed = matchupsContainer.classList.toggle("collapsed");
    if (window.innerWidth <= 670) {
      localStorage.setItem("matchupsCollapsedMobile", isCollapsed);
    }
    toggleBtn.textContent = isCollapsed ? "Show Matchups" : "Hide Matchups";
  });

  window.addEventListener("resize", updateToggleState);
  window.addEventListener("DOMContentLoaded", updateToggleState);
  </script>

  <!-- ðŸš€ Share + Backend -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const siteURL = window.location.href;
    const subject = encodeURIComponent("Fantasy Goons Weekly Update");
    const body = encodeURIComponent(`Check out this week's Fantasy Goons Power Rankings:\n\n${siteURL}`);

    document.getElementById("share-email").addEventListener("click", () => {
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    });
    document.getElementById("share-sms").addEventListener("click", () => {
      window.location.href = `sms:?body=${body}`;
    });

    const sendBtn = document.getElementById("send-update-btn");
    sendBtn.addEventListener("click", async () => {
      const weekTitle = document.getElementById("week-title").textContent;
      const message = `Fantasy Goons ${weekTitle} update sent!`;
      try {
        const response = await fetch("/api/send-update", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            week: weekTitle.replace(/\D/g, ""),
            message
          })
        });
        const data = await response.json();
        if (data.success) alert(`âœ… ${data.info}`);
        else alert(`âš ï¸ Error: ${data.error || "Something went wrong."}`);
      } catch (err) {
        alert(`âŒ Failed to reach backend: ${err.message}`);
      }
    });
  });
  </script>

  <!-- ðŸª„ Floating Toggle Fade Behavior -->
  <script>
  let lastScrollY = window.scrollY;
  if (toggleBtn) {
    toggleBtn.style.transition = "transform 0.5s ease, opacity 0.35s ease";
    toggleBtn.style.willChange = "transform, opacity";
    window.addEventListener("scroll", () => {
      const currentY = window.scrollY;
      if (currentY > lastScrollY && currentY > 100) {
        toggleBtn.style.transform = "translateY(100px)";
        toggleBtn.style.opacity = "0";
      } else {
        toggleBtn.style.transform = "translateY(0)";
        toggleBtn.style.opacity = "1";
      }
      lastScrollY = currentY;
    });
  }
  </script>
<script>
(function() {
  const menuToggle = document.querySelector('.menu-toggle');
  const navLinks = document.querySelector('.nav-links');
  if (!menuToggle || !navLinks) return;

  const setIcon = (isOpen) => {
    menuToggle.innerHTML = isOpen ? '&times;' : '&#9776;';
  };

  const closeMenu = () => {
    navLinks.classList.remove('show');
    document.body.classList.remove('menu-open');
    menuToggle.setAttribute('aria-expanded', 'false');
    setIcon(false);
  };

  setIcon(false);

  menuToggle.addEventListener('click', () => {
    const isOpen = navLinks.classList.toggle('show');
    document.body.classList.toggle('menu-open', isOpen);
    menuToggle.setAttribute('aria-expanded', String(isOpen));
    setIcon(isOpen);
  });

  navLinks.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', closeMenu);
  });

  window.addEventListener('resize', () => {
    if (window.innerWidth > 768) closeMenu();
  });
})();
</script>
</body>
</html>


